<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="MobileOptimized" content="176"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="robots" content="noindex,nofollow"/>
    <title></title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://telegram.org/js/telegram-web-app.js?1"></script>
    <script>
      function setThemeClass() {
        document.documentElement.className = Telegram.WebApp.colorScheme;
      }

      Telegram.WebApp.onEvent('themeChanged', setThemeClass);
      setThemeClass();

    </script>
</head>

<body>
<section class="form-content">
    <div id="sb-1" class="select-box">
        <span class="select_header">Тест4</span>
        <div class="city-select-content">
            <div class="city-select-content-item">
                <input id="checkbox-1-city-tbilisi" type="checkbox" class="custom-checkbox" data-val=true value=true>
                <label for="checkbox-1-city-tbilisi" class="checkbox-label">Тбилиси</label>
            </div>
            <div class="city-select-content-item">
                <input id="checkbox-2-city-batumi" type="checkbox" class="custom-checkbox" data-val=true value=true>
                <label for="checkbox-2-city-batumi" class="checkbox-label">Батуми</label>
            </div>
        </div>
    </div>
    <div id="sb-2" class="select-box">
        <span class="select_header">Выбор района</span>
        <div class="district-select-content">
            <select multiple id="districts">
                <option value="0" hidden>Выберите район</option>
                <option value="1">Район 1</option>
                <option value="2">Район 2</option>
                <option value="3">Район 3</option>
                <option value="4">Район 4</option>
                <option value="5">Район 5</option>
                <option value="6">Район 6</option>
            </select>
        </div>
    </div>
    <div class="wrapper">
        <input id="cost-1" class="input-with-mark" type="number" value=1 min=1 step="1" max=9999999/>
        <label for="cost-1" class="cost-label">Стоимость от</label>
        <div class="units">
            <span class="invisible" id="cost-1-hiddenValue">0</span>
            <span class="units-value" id="cost-1-unitsValue"> $</span>
        </div>
    </div>
    <div class="wrapper">
        <input id="cost-2" class="input-with-mark" type="number" value=1000 min=1 step="1" max=9999999/>
        <label for="cost-2" class="cost-label">Стоимость до</label>
        <div class="units">
            <span class="invisible" id="cost-2-hiddenValue">1000</span>
            <span class="units-value" id="cost-2-unitsValue"> $</span>
        </div>
    </div>
    <div class="wrapper">
        <input id="area-1" class="input-with-mark" type="number" value=1 min=1 step="1" max=99999/>
        <label for="area-1" class="cost-label">Площадь от</label>
        <div class="units">
            <span class="invisible" id="area-1-hiddenValue">1</span>
            <span class="units-value" id="area-1-unitsValue"> м²</span>
        </div>
    </div>
    <div class="wrapper">
        <input id="area-2" class="input-with-mark" type="number" value=75 min=1 step="1" max=99999/>
        <label for="area-2" class="cost-label">Площадь до</label>
        <div class="units">
            <span class="invisible" id="area-2-hiddenValue">75</span>
            <span class="units-value" id="area-2-unitsValue"> м²</span>
        </div>
    </div>
    <div class="wrapper">
        <input id="rooms-1" class="input-with-mark" type="number" value=1 min=1 step="1" max=10/>
        <label for="rooms-1" class="cost-label">Комнат от</label>
        <div class="units">
            <span class="invisible" id="rooms-1-hiddenValue">1</span>
            <span class="units-value" id="rooms-1-unitsValue"></span>
        </div>
    </div>
    <div class="wrapper">
        <input id="rooms-2" class="input-with-mark" type="number" value=5 min=0 step="1" max=10/>
        <label for="rooms-2" class="cost-label">Комнат до</label>
        <div class="units">
            <span class="invisible" id="rooms-2-hiddenValue">5</span>
            <span class="units-value" id="rooms-2-unitsValue"></span>
        </div>
    </div>

    <div id="sb-3" class="city-select-box">
        <span class="select_header">Собственники</span>
        <div class="city-select-content">
            <div class="city-select-content-item">
                <input id="checkbox-3-animals-yes" type="checkbox" class="custom-checkbox" data-val=true value=true>
                <label for="checkbox-3-animals-yes" class="checkbox-label">Да</label>
            </div>

        </div>

    </div>
    <div id="sb-4" class="city-select-box">
        <span class="select_header">С фотографией</span>
        <div class="city-select-content">
            <div class="city-select-content-item">
                <input id="checkbox-4-photo-yes" type="checkbox" class="custom-checkbox" data-val=true value=true
                       checked>
                <label for="checkbox-4-photo-yes" class="checkbox-label">Да</label>
            </div>
        </div>
    </div>
</section>
<script>

    const _cost_1 = document.getElementById('cost-1');


  // Input Validation
  const cost_1 = document.getElementById("cost-1");
  const cost_1_hiddenValue = document.getElementById("cost-1-hiddenValue");
  cost_1.addEventListener("input", () => { // Стоимость от
    if (cost_1.value > 999999999) {
      cost_1.value = 999999999;
    } else if (cost_1.value.length === 0) {
      cost_1.value = 0;
      cost_1_hiddenValue.innerHTML = "0";
    } else if (cost_1_hiddenValue.innerHTML === "0") {
      cost_1_hiddenValue.innerHTML = cost_1.value.substring(1);
      cost_1.value = cost_1.value.substring(1);
    } else {
      cost_1_hiddenValue.innerHTML = cost_1.value;
    }
  });


  const cost_2 = document.getElementById("cost-2"); // Стоимость до
  const cost_2_hiddenValue = document.getElementById("cost-2-hiddenValue");
  cost_2.addEventListener("input", () => { // Стоимость до
    if (cost_2.value > 999999999) {
      cost_2.value = 999999999;
    } else if (cost_2.value.length === 0) {
      cost_2.value = 0;
      cost_2_hiddenValue.innerHTML = "0";
    } else if (cost_2_hiddenValue.innerHTML === "0") {
      cost_2_hiddenValue.innerHTML = cost_2.value.substring(1);
      cost_2.value = cost_2.value.substring(1);
    } else {
      cost_2_hiddenValue.innerHTML = cost_2.value;
    }
  });

  const area_1 = document.getElementById("area-1"); // Площадь от
  const area_1_hiddenValue = document.getElementById("area-1-hiddenValue");
  area_1.addEventListener("input", () => {
    if (area_1.value > 99999) {
      area_1.value = 99999;
    } else if (area_1.value.length === 0) {
      area_1.value = 0;
      area_1_hiddenValue.innerHTML = "0";
    } else if (area_1_hiddenValue.innerHTML === "0") {
      area_1_hiddenValue.innerHTML = area_1.value.substring(1);
      area_1.value = area_1.value.substring(1);
    } else {
      area_1_hiddenValue.innerHTML = area_1.value;
    }
  });


  const area_2 = document.getElementById("area-2"); // Площадь до
  const area_2_hiddenValue = document.getElementById("area-2-hiddenValue");
  area_2.addEventListener("input", () => {
    if (area_2.value > 99999) {
      area_2.value = 99999;
    } else if (area_2.value.length === 0) {
      area_2.value = 0;
      area_2_hiddenValue.innerHTML = "0";
    } else if (area_2_hiddenValue.innerHTML === "0") {
      area_2_hiddenValue.innerHTML = area_2.value.substring(1);
      area_2.value = area_2.value.substring(1);
    } else {
      area_2_hiddenValue.innerHTML = area_2.value;
    }
  });

  const rooms_1 = document.getElementById("rooms-1"); // Комнат от
  const rooms_1_hiddenValue = document.getElementById("rooms-1-hiddenValue");
  rooms_1.addEventListener("input", () => {
    if (rooms_1.value.length === 0) {
      rooms_1.value = 1;
      rooms_1_hiddenValue.innerHTML = "1";
    } else {
      rooms_1_hiddenValue.innerHTML = rooms_1.value.substring(1);
      rooms_1.value = rooms_1.value.substring(1);
    }

  });


  const rooms_2 = document.getElementById("rooms-2"); // Комнат до
  const rooms_2_hiddenValue = document.getElementById("rooms-2-hiddenValue");
  rooms_2.addEventListener("input", () => {
    if (rooms_2.value.length === 0) {
      rooms_2.value = 1;
      rooms_2_hiddenValue.innerHTML = "1";
    } else {
      rooms_2_hiddenValue.innerHTML = rooms_2.value.substring(1);
      rooms_2.value = rooms_2.value.substring(1);
    }
  });



  // Telegram Web App
  Telegram.WebApp.ready();

  Telegram.WebApp.MainButton.show();
  Telegram.WebApp.MainButton.setText('Подтвердить');
  Telegram.WebApp.MainButton.onClick(() => {
    sendForm()
  })

  Telegram.WebApp.MainButton.show();

  Telegram.WebApp.onEvent('themeChanged', function () {
    document.querySelector('#themeData').innerHTML = JSON.stringify(Telegram.WebApp.themeParams, null, 2);
  });

  function webviewClose() {
    Telegram.WebApp.close();
  }

  async function sendForm() {
    const Tbilisi = document.getElementById("checkbox-1-city-tbilisi").checked.toString();
    const Batumi = document.getElementById("checkbox-2-city-batumi").checked.toString();

    const price_from = document.getElementById("cost-1").value;
    const price_to = document.getElementById("cost-2").value;

    const area_from = document.getElementById("area-1").value;
    const area_to = document.getElementById("area-2").value;

    const rooms_from = document.getElementById("rooms-1").value;
    const rooms_to = document.getElementById("rooms-2").value;

    const district = document.getElementById("districts").value;

    const owners = document.getElementById("checkbox-3-animals-yes").checked

    const photo = document.getElementById("checkbox-4-photo-yes").checked

    const data = {

      city: Tbilisi && Batumi ? '*' : Tbilisi ? "Tbilisi" : "Batumi",
      price_from,
      price_to,
      area_from,
      area_to,
      district,
      rooms_from,
      rooms_to,
      owners,
      photo

    }

    if (price_from > 0 && price_to > price_from && area_from > 0 && area_to > area_from && district.length > 0) {
      const dataString = JSON.stringify(data);
      Telegram.WebApp.sendData(dataString);
      webviewClose();
    } else {
      alert("Неверно введены данные");
    }
  }
</script>
<script>

</script>
</body>
</html>